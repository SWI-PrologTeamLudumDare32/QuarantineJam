<!DOCTYPE html>
<link rel="stylesheet" href="./reset.css">
<link rel="stylesheet" href="./game.css">
<script src="/static/js/vendor/mithril-2.0.4.js"></script>

<div id="app"></div>

<script>
  let state = null
  let oops = ''

const App = {
  view() {
    if (!state) {
      return m('div', 'Loading...')
    }
    return [
      m('.desktop',
        m('.side',
          m('.report-letter'),
        ),
        m('.side',
          m('.inventory-letter'),
        ),

        m('.decoration.decoration-photo',
          m('img[src=/static/img/desktop/oldcamper.jpg]')
        ),
        m('.decoration.decoration-drink',
          m('img[src=/static/img/desktop/wineglass.png]')
        )
      ),
    ]
  }
}

async function act(action) {
  const response = await m.request({
    method: 'POST',
    url: '/game_turn',
    body: { action },
  })

  state = {
    things: response.things.reduce((hash, [name, id]) => {
      hash[id] = { name: name, status: {} }
      return hash
    }, {}),
    assets: response.assets.reduce((hash, [name, amount]) => {
      hash[name] = amount
      return hash
    }, {}),
    env: response.env.reduce((hash, [key, value]) => {
      hash[key] = value
      return hash
    }, {}),
    actions: response.available_actions,
  }
  response.statuses.forEach(([id, name, value]) => {
    state.things[id].status[name] = value
  })
  oops = response.error
}

act('get_state')

m.mount(document.getElementById('app'), App)
</script>
